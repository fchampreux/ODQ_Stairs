     
<script>

$(function () { 
    $('#measures_trend').highcharts({
        chart: {type: 'column'},
        title: {text: 'Data quality trend'},
        xAxis: { 
            type: 'datetime',
            title: {text: 'Time'}
            },
        yAxis: {
            title: {text: 'Score'}
        },
       series: [{
            name: 'Business Process',
            data: <%= raw @business_process_history.map { |bp| [ bp.score.to_f] } %>,
            pointStart: <%= 10.days.ago.at_midnight.to_i * 1000 %>,
            pointInterval: 24 * 3600 * 1000 // one day
        }]
    });
});
</script>
<script>
$(function () { 
    $('#measures_children').highcharts({
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: 1,//null,
            plotShadow: false
        },
        title: {
            text: 'Descendant impact on data quality'
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                    style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                    }
                }
            }
        },
       series: [{
            data:  <%= raw @business_process_children.map { |br| [ br.odq_object_id, br.error_count.to_f] } %> ,
            type: 'pie',
            name: 'Business Rule'
        }]
    });
});
</script>


<% provide(:title, 'Managing business processes') %>

  <ul class="breadcrumbs">
    <li>> <%= link_to @business_process.business_flow.business_area.name, @business_process.business_flow.business_area %> > </li>
    <li><%= link_to @business_process.business_flow.name, @business_process.business_flow %> > </li>
    <li><%= @business_process.name %> </li>
  </ul>

  <h1><%= image_tag(index_audit_tag_for(@business_process), :alt => "Quality hit") %> Business Process: <%= @business_process.name %></h1>

  <ul class="mid_menu">
    <li><%= link_to 'Edit', edit_business_process_path(@business_process) %> |</li>
    <li><%= link_to 'Up', @business_process.business_flow %> |</li>
    <li><%= link_to 'Destroy', @business_process, confirm: 'Are you sure?', method: :delete %></li>
  </ul>

<!-- <p id="notice"><%= notice %></p> -->

  <div class="tabbable">
    <ul class="nav nav-tabs">
      <li><a href="#tab1" data-toggle="tab">Definition</a></li>
      <li class="active"><a href="#measures" data-toggle="tab">Measures</a></li>
      <li><a href="#tab2" data-toggle="tab">Ownership</a></li>
    </ul>
    <div class="tab-content">

    <div class="tab-pane" id="tab1">
<!-- Tab content for Definition -->

      <div class="row">
        <div class="span2 text-right">Name:
        </div>
        <div class="span6"><%= @business_process.name%>
        </div>
        <div class="span1 text-right">Code:
        </div>
        <div class="span1"><%= @business_process.code%>
        </div>
        <div class="span1 text-right">Status:
        </div>
        <div class="span1"><%= @business_process.status.name%>
        </div>
      </div>

      <div class="row">
        <div class="span2 text-right">Description:
        </div>
        <div class="span6"><pre><%= @business_process.description%></pre>
        </div>
      </div>

      <div class="row">
        <div class="span2 text-right">Hierarchy:
        </div>
        <div class="span2"><%= @business_process.hierarchy%>
        </div>
      </div>

      <div class="row">
        <div class="span2 text-right">PCF index:
        </div>
        <div class="span2"><%= @business_process.PCF_index%>
        </div>
        <div class="span2 text-right">PCF reference:
        </div>
        <div class="span2"><%= @business_process.PCF_reference%>
        </div>
      </div>


<!-- Tab content -->
    </div>    
    <div class="tab-pane active" id="measures">
<!-- Tab content for Definition -->

      <div class="row">
        <div class="span6">
          <div id="measures_trend" style="width:80%; height:400px;"></div>
        </div>
        <div class="span6">
          <div id="measures_children" style="width:80%; height:400px;"></div>
        </div>
      </div>

      

      <div class="row">
        <div class="span6">
        </div>
        <div class="span6">
        </div>    
      </div>


<!-- Tab content -->
    </div>    

    <div class="tab-pane" id="tab2">
<!-- Tab content for Ownership -->

      <div class="row">
        <div class="span2 text-right">Unique id:
        </div>
        <div class="span2"><%= @business_process.id%>
        </div>
        <div class="span2 text-right">Created by:
        </div>
        <div class="span2"><%= @business_process.created_by%>
        </div>
      </div>
      <div class="row">
        <div class="span2 text-right">Playground id:
        </div>
        <div class="span2"><%= @business_process.playground_id%>
        </div>
        <div class="span2 text-right">Created at:
        </div>
        <div class="span2"><%= @business_process.created_at%>
        </div>
      </div>
      <div class="row">
        <div class="span2 text-right">Owner:
        </div>
        <div class="span2"><%= @business_process.owner.login%>
        </div>
        <div class="span2 text-right">Updated by:
        </div>
        <div class="span2"><%= @business_process.updated_by%>
        </div>
      </div>
      <div class="row">
        <div class="span2 text-right">Parent:
        </div>
        <div class="span2"><%= link_to @business_process.business_flow.name, @business_process.business_flow %>
        </div>
        <div class="span2 text-right">updated at:
        </div>
        <div class="span2"><%= @business_process.updated_at%>
        </div>
      </div>

<!-- Tab content -->
    </div>
    
    </div>
  </div>

<table width=100%>
  <tr><td><hr /></td></tr>
  <tr align="left">
    <th>Linked business rules</th>
    <th></th>
  </tr>
  <tr>
    <td>
      <table class="table table-striped table-condensed">
        <tr align="left">
          <th> </th>
          <th> Code </th>
          <th> Name </th>
          <th> Description </th>
          <th> Updated by </th>
          <th> Updated at </th>
        </tr>
        <%@business_process.business_rules.order("code ASC").each do |business_rule| %>
        <tr align="left">
          <td><%= image_tag(index_audit_tag_for(business_rule), :alt => "Quality hit") %></td>
          <td valign="top"> <%=link_to business_rule.code, business_rule%> </td>
          <td valign="top"> <%=business_rule.name%> </td>
          <td class="col_wide"> <%=business_rule.description%> </td>
          <td valign="top"> <%=business_rule.updated_by%> </td>
          <td valign="top"> <%=business_rule.updated_at%> </td>
        </tr>
        <% end%>
      </table>
    </td>
  </tr>
  <tr>
    <td>
      <%= link_to 'Add business rule', new_business_process_business_rule_path(@business_process) %>
    </td>
  </tr>
</table>




