<!-- This partial renders the charts for various objects -->
<!-- Series are built by methods available in the views helper -->

<script>
$(function () { 
    $('#measures_trend').highcharts({
        chart: {type: 'column'},
        title: {text: 'Data quality trend'},
        xAxis: { 
            type: 'datetime',
            title: {text: 'Time'}
            },
        yAxis: {
            title: {text: 'Score'}
        },
       series: [{
            name: 'Quality',
            data: <%= raw scores_chart_series_for(this_object).map { |bp| [ bp.to_f] } %>,
            pointStart: <%= 10.days.ago.at_midnight.to_i * 1000 %>,
            pointInterval: 24 * 3600 * 1000 // one day
        }]
    });
});
</script>

<script>
$(function () {
    var $reporting = $('#reporting');
    $('#measures_children').highcharts({
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: 1,//null,
            plotShadow: false
        },
        title: {
            text: 'Descendants impact on data quality'
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: false,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    format: '<b>{point.options.code}</b>: {point.percentage:.1f} %',
                    style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                    }
                },
                point: {
                    events: {
                        click: function () {
                            location.href = this.options.url;
                            }
                    }
                } 
            }
        },
        series: [{
            data:  <%= raw errors_chart_series_for(this_object).map { |br| { name: br.name, y: br.error_count.to_f, url: br.url, code: br.code } }.to_json %> ,
            type: 'pie',
            name: 'Weight'
        }]
    });
});
</script>

<!-- Tab content for Measures -->
      <div class="row">
        <div class="span6">
          <div id="measures_trend" style="width:80%; height:400px;"></div>
        </div>
        <div class="span6">
          <div id="measures_children" style="width:100%; height:400px;"></div>
        </div>
      </div>
<!-- End of tab content -->