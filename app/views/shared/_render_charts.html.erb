<!-- This partial renders the charts for various objects -->
<!-- Series are built by methods available in the views helper -->

<script>
$(function () { 
    $('#measures_trend').highcharts({
        chart: {type: 'column'},
        title: {text: '<%=t('DQT')%>'},
        xAxis: { 
            type: 'datetime',
            title: {text: 'Time'}
            },
        yAxis: {
            title: {text: 'Score'}
        },
       series: [{
            name: '<%= t('Quality') %>',
            data: <%= raw scores_chart_series_for(this_object).map { |bp| [ bp.to_f] } %>,
            pointStart: <%= 10.days.ago.at_midnight.to_i * 1000 %>,
            pointInterval: 24 * 3600 * 1000 // one day
        }]
    });
});
</script>

<script>
$(function () {
    var $reporting = $('#reporting');
    $('#percentage').highcharts({
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: 1,//null,
            plotShadow: false
        },
        title: {
            text: '<%= t('ImpactDQ') %>'
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: false,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    format: '<b>{point.options.code}</b>: {point.percentage:.1f} %',
                    style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                    }
                },
                point: {
                    events: {
                        click: function () {
                            location.href = this.options.url;
                            }
                    }
                } 
            }
        },
        series: [{
            data:  <%= raw errors_chart_series_for(this_object).map { |br| { name: br.name, y: br.error_count.to_f, url: br.url, code: br.code } }.to_json %> ,
            type: 'pie',
            name: 'Weight'
        }]
    });
});
</script>

<script>
$(function () {
    var $reporting = $('#reporting');
    $('#added_value').highcharts({
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: 1,//null,
            plotShadow: false
        },
        title: {
            text: '<%= t('ImpactAV') %>'
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: false,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    format: '<b>{point.options.code}</b>: {point.y:.1f} â‚¬',
                    style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                    }
                },
                point: {
                    events: {
                        click: function () {
                            location.href = this.options.url;
                            }
                    }
                } 
            }
        },
        series: [{
            data:  <%= raw added_value_chart_series_for(this_object).map { |br| { name: br.name, y: br.added_value.to_f, url: br.url, code: br.code } }.to_json %> ,
            type: 'pie',
            name: '<%=t('Weight') %>'
        }]
    });
});
</script>

<script>
$(function () {
    var $reporting = $('#reporting');
    $('#workload').highcharts({
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: 1,//null,
            plotShadow: false
        },
        title: {
            text: '<%= t('ImpactWL') %>'
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: false,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    format: '<b>{point.options.code}</b>: {point.percentage:.1f} %',
                    style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                    }
                },
                point: {
                    events: {
                        click: function () {
                            location.href = this.options.url;
                            }
                    }
                } 
            }
        },
        series: [{
            data:  <%= raw workload_chart_series_for(this_object).map { |br| { name: br.name, y: br.workload.to_f, url: br.url, code: br.code } }.to_json %> ,
            type: 'pie',
            name: 'Weight'
        }]
    });
});
</script>


<!-- Tab content for Measures -->
      <div class="row">
        <div class="col-md-6">
          <div id="measures_trend" style="width:80%; height:400px;"></div>
        </div>
        <div class="col-md-6">
          <div class="tabbable tabs-left">
            <ul class="nav nav-tabs">
              <li class="active"><a href="#tab_percentage" data-toggle="tab"><%= t('Percentage') %> </a></li>
              <li><a href="#tab_added_value" data-toggle="tab"><%= t('AddedValue') %> </a></li>
              <li><a href="#tab_workload" data-toggle="tab"><%= t('Workload') %> </a></li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane active" id="tab_percentage">
                <div id="percentage" ></div>
              </div>  
              <div class="tab-pane" id="tab_added_value">
                <div id="added_value" ></div>
              </div>  
              <div class="tab-pane" id="tab_workload">
                <div id="workload" ></div>
              </div>
            </div>  
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <svg id="progression2">
          </svg>
        </div>
        <div class="col-md-6">
          <svg id="impact">
          </svg>
        </div>
      </div>
<!-- End of tab content -->

<script type="text/javascript">

d3.select("#progression").append("p").text("Progression");


var data = [4, 8, 15, 16, 23, 42];

var width = 420,
    barHeight = 20;

var x = d3.scale.linear()
    .domain([0, d3.max(data)])
    .range([0, width]);

var chart = d3.select("#progression")
    .attr("width", width)
    .attr("height", barHeight * data.length);

var bar = chart.selectAll("g")
    .data(data)
  .enter().append("g")
    .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

bar.append("rect")
    .attr("width", x)
    .attr("height", barHeight - 1);

bar.append("text")
    .attr("x", function(d) { return x(d) - 3; })
    .attr("y", barHeight / 2)
    .attr("dy", ".35em")
    .text(function(d) { return d; });

</script>


<script type="text/javascript">

d3.select("#impact").append("p").text("Impact");

</script>